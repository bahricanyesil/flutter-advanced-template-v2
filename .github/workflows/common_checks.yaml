name: Common Checks

on:
  workflow_call:
    secrets:
      ssh_key:
        required: false

jobs:
  license-check:
    uses: ./.github/workflows/ci/license_check.yaml

  decode-github-secrets:
    secrets: inherit
    uses: ./.github/workflows/ci/decode_github_secrets.yaml

  cache:
    needs:
      - decode-github-secrets
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    uses: ./.github/workflows/ci/cache.yaml
    with:
      cache_key: ${{ matrix.os }}-flutter
      cache_path: ~/.pub-cache

  test-and-analysis:
    uses: ./.github/workflows/ci/test_and_analysis.yaml
    secrets: inherit
    needs:
      - license-check
      - cache